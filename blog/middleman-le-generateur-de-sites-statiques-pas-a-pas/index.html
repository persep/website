<!DOCTYPE html> <html> <head> <title>Middleman, le générateur de sites statiques pas à pas</title> <meta charset=UTF-8> <meta content='Le but de cet article est de monter un blog, pour raconter ma vie, basé sur la stack de technologies suivantes :&#x000A;&#x000A;&#x000A;Middleman : génération de sites statiques&#x000A;Slim (templating HTML)&#x000A;Sass (feuilles de style)&#x000A;CoffeeScript (javascript)&#x000A;Markdown pour le contenu des articles' name=description> <meta content='width=device-width, initial-scale=1.0, user-scalable=no' name=viewport> <meta content='Middleman, le générateur de sites statiques pas à pas' property='og:title'> <meta content='Le but de cet article est de monter un blog, pour raconter ma vie, basé sur la stack de technologies suivantes :&#x000A;&#x000A;&#x000A;Middleman : génération de sites statiques&#x000A;Slim (templating HTML)&#x000A;Sass (feuilles de style)&#x000A;CoffeeScript (javascript)&#x000A;Markdown pour le contenu des articles' property='og:description'> <meta content=fr_FR property='og:locale'> <meta content='Alpine Lab' property='og:site_name'> <meta content='http://www.alpine-lab.com/blog/middleman-le-generateur-de-sites-statiques-pas-a-pas/' property='og:url'> <meta content='http://www.alpine-lab.com../../images/logo-alpinelab-500.png' property='og:image'> <meta content=article property='og:type'> <link href='images/favicon.png' rel=icon> <link href='//fonts.googleapis.com/css?family=Lato:300,400,700%7CMontserrat:400,700' rel=stylesheet> <link href="../../stylesheets/blog-fb2780ef.css" rel=stylesheet /> <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.min.css" rel=stylesheet /> </head> <body class='blog blog_middleman-le-generateur-de-sites-statiques-pas-a-pas blog_middleman-le-generateur-de-sites-statiques-pas-a-pas_index'> <meta content='Alpine Lab, blog technique' itemprop=name> <meta content="On parle de développement web, d'entreprenariat, de Ruby/Rails, de Haml/Slim, de Sass, de CoffeeScript et d'Ember.js" itemprop=description> <meta content='http://www.alpine-lab.com/blog' itemprop=url> <meta content=fr itemprop=inLanguage> <meta content='http://www.alpine-lab.com../../images/logo-alpinelab-500.png' itemprop=image> <div id=wrapper> <header> <a href="/blog"><div class=logo></div> <h1 class=sitename><span class=alpine>Alpine</span><span class=lab>Lab</span> <span class=blog>blog technique</span> </h1> </a> <div class=social-networks> <a target=_blank href="https://github.com/alpinelab"><i class='fa fa-github'></i> </a> <a target=_blank href="https://twitter.com/alpinelab"><i class='fa fa-twitter'></i> </a> </div> </header> <div id=main> <article itemscope itemtype='http://schema.org/BlogPosting'> <meta content='Le but de cet article est de monter un blog, pour raconter ma vie, basé sur la stack de technologies suivantes :&#x000A;&#x000A;&#x000A;Middleman : génération de sites statiques&#x000A;Slim (templating HTML)&#x000A;Sass (feuilles de style)&#x000A;CoffeeScript (javascript)&#x000A;Markdown pour le contenu des articles' itemprop=description> <meta content='http://www.alpine-lab.com/blog/middleman-le-generateur-de-sites-statiques-pas-a-pas/' itemprop=url> <meta content=fr itemprop=inLanguage> <h1 itemprop='name headline'>Middleman, le générateur de sites statiques pas à pas</h1> <time class=published datetime=2013-03-07 itemprop=datePublished> Publié le 07/03/2013 </time> <ul class=tags> <li> <i class='fa fa-tags'></i> </li> <li><a href="/blog/tags/middleman/">Middleman</a></li> <li><a href="/blog/tags/slim/">Slim</a></li> <li><a href="/blog/tags/sass/">Sass</a></li> <li><a href="/blog/tags/coffeescript/">Coffeescript</a></li> <li><a href="/blog/tags/markdown/">Markdown</a></li> <li><a href="/blog/tags/github-pages/">Github pages</a></li> </ul> <div class=post-body itemprop=articleBody> <p>Le but de cet article est de monter un blog, pour raconter ma vie, basé sur la stack de technologies suivantes :</p> <ul> <li><a href="//middlemanapp.com/">Middleman</a> : génération de sites statiques</li> <li><a href="//slim-lang.com/">Slim</a> (templating HTML)</li> <li><a href="//sass-lang.com/">Sass</a> (feuilles de style)</li> <li><a href="//coffeescript.org/">CoffeeScript</a> (javascript)</li> <li><a href="//daringfireball.net/projects/markdown/">Markdown</a> pour le contenu des articles</li> </ul> <p>Ce site sera hébergé par GitHub, parce que payer un dyno <a href="//www.heroku.com">Heroku</a> 30$ par mois pour raconter ma vie, non merci. On va donc utiliser la fonction GitHub Pages.</p> <p>Cet article traite de la mise en place du site et de la stack technologique. Dans un prochain article, on verra comment transformer tout ça en un blog avec toutes les fonctionnalités qui vont bien (tags, organisation en articles, pretty URLs, etc&hellip;).</p> <h3 id="préambule">Préambule</h3> <p>Cet article est un peu long parce que c&#39;est un &ldquo;pas à pas&rdquo;. Si vous voulez juste le résumé, rendez-vous <a href="#resume">en fin d&#39;article</a>.</p> <p>Pour lire cet article, mieux vaut déjà maitriser git, GitHub et les langages utilisés (Slim, Markdown, Sass, CoffeeScript, &hellip;).</p> <h2 id=installation-de-middleman>Installation de Middleman</h2> <p>On commence par la base, installer Middleman :</p> <pre class="highlight shell"><code><span class="gp">$ </span>gem install middleman&#x000A;</code></pre> <p>On crée ensuite le squelette avec le template HTML5 boilerplate :</p> <pre class="highlight shell"><code><span class="gp">$ </span>middleman init blog-alpinelab --template<span class="o">=</span>html5&#x000A;</code></pre> <p>On initialise Git :</p> <pre class="highlight shell"><code><span class="gp">$ </span><span class="nb">cd </span>blog-alpinelab&#x000A;<span class="gp">$ </span>git init&#x000A;</code></pre> <p>On commite nos supers nouveaux fichiers en local :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git add .&#x000A;<span class="gp">$ </span>git commit -a -m <span class="s1">'Initial commit: empty Middleman skeleton'</span>&#x000A;</code></pre> <p>On ajoute alors le code généré au repository GitHub qui va abriter les sources du blog (attention, il y aura un autre repository pour les fichiers compilés, celui-ci c&#39;est vraiment juste pour les sources) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git remote add origin git@github.com:alpinelab/blog-alpinelab.git&#x000A;<span class="gp">$ </span>git push -u origin master&#x000A;</code></pre> <p>On peut tester en lançant le serveur Middleman :</p> <pre class="highlight shell"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>middleman server&#x000A;</code></pre> <p>Et en pointant son navigateur vers <a href="//localhost:4567">http://localhost:4567</a>, on doit avoir ça :</p> <p><img title="Hello World Middleman" alt="Middleman Hello World" width=453 height=224 src="../../images/blog/middleman-01-hello-world-f6c72670.png"/></p> <h2 id=installation-de-jquery>Installation de jQuery</h2> <p>La version de <a href="//jquery.com">jQuery</a> installée par défaut est un peu vieille, j&#39;ai préféré la mettre à jour, mais cette étape n&#39;est vraiment pas obligatoire.</p> <p>On commence par supprimer l&#39;ancienne version :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git rm <span class="nb">source</span>/js/vendor/jquery-1.8.1.min.js&#x000A;</code></pre> <p>On télécharge ensuite la nouvelle version :</p> <pre class="highlight shell"><code><span class="gp">$ </span>curl -o <span class="nb">source</span>/js/vendor/jquery-1.9.1.min.js http://code.jquery.com/jquery-1.9.1.min.js&#x000A;</code></pre> <p>Plus qu&#39;à committer :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git add <span class="nb">source</span>/js/vendor/jquery-1.9.1.min.js&#x000A;<span class="gp">$ </span>git commit -a -m <span class="s1">'Mise a jour de jQuery'</span>&#x000A;<span class="gp">$ </span>git push&#x000A;</code></pre> <h2 id=installation-de-slim>Installation de Slim</h2> <p>Pour commencer, on ajoute <a href="//slim-lang.com">Slim</a> au fichier <code>Gemfile</code> :</p> <pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'slim'</span>&#x000A;</code></pre> <p>On met ensuite le bundle à jour :</p> <pre class="highlight shell"><code><span class="gp">$ </span>bundle install&#x000A;</code></pre> <p>Dans un premier temps, on va transformer le fichier qui correspond à la page d&#39;accueil (qui est par défaut en ERb) en un fichier Slim. Il faut pour ça renommer <code>index.html.erb</code> en <code>index.html.slim</code> :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git mv <span class="nb">source</span>/index.html.erb <span class="nb">source</span>/index.html.slim&#x000A;</code></pre> <p>On modifie ensuite le contenu de <code>source/index.html.slim</code> pour qu&#39;il ressemble à ça :</p> <pre class="highlight slim"><code><span class="p">-</span><span class="o">--</span>&#x000A;<span class="nt">title</span>:<span class="w"> </span>HTML5<span class="w"> </span>Boilerplate<span class="w"> </span>Middleman&#x000A;<span class="p">-</span><span class="o">--</span>&#x000A;&#x000A;<span class="nt">p</span>&#x000A;  <span class="p">|</span> Hello world! This is HTML5 Boilerplate powered by SLIM.&#x000A;&#x000A;</code></pre> <p>Note: les 3 premières lignes forment ce qu&#39;on appelle le <a href="//middlemanapp.com/frontmatter">FrontMatter</a>. Il permet de definir des variables relatives à la page HTML qui va être générée (layout, titre, etc&hellip;). Ici, on définit uniquement le titre de la page.</p> <p>On va faire pareil avec le fichier de layout <code>layout.erb</code> qu&#39;on renomme en en <code>layout.slim</code> :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git mv <span class="nb">source</span>/layouts/layout.erb <span class="nb">source</span>/layouts/layout.slim&#x000A;</code></pre> <p>On traduit alors son contenu en Slim. Ça doit ressembler à peu près à ça (désolé, en Slim, j&#39;ai pas la coloration syntaxique, sur le blog) :</p> <pre class="highlight slim"><code><span class="nn">doctype</span><span class="w"> </span>html&#x000A;<span class="c">/[if lt IE 7]</span>&#x000A;  <span class="nt">html</span><span class="w"> </span><span class="na">class</span><span class="p">=</span><span class="s">"no-js lt-ie9 lt-ie8 lt-ie7"</span>&#x000A;<span class="c">/[if IE 7]</span>&#x000A;  <span class="nt">html</span><span class="w"> </span><span class="na">class</span><span class="p">=</span><span class="s">"no-js lt-ie9 lt-ie8"</span>&#x000A;<span class="c">/[if IE 8]</span>&#x000A;  <span class="nt">html</span><span class="w"> </span><span class="na">class</span><span class="p">=</span><span class="s">"no-js lt-ie9"</span>&#x000A;<span class="c">/[if gt IE 8]</span>&#x000A;  <span class="err">&lt;!</span><span class="p">-</span><span class="o">-&gt;</span> <span class="o">&lt;</span><span class="n">html</span> <span class="k">class</span><span class="o">=</span><span class="s2">"no-js"</span><span class="o">&gt;</span> <span class="o">&lt;!--</span>&#x000A;<span class="nt">head</span>&#x000A;  <span class="nt">meta</span><span class="w"> </span><span class="na">charset</span><span class="p">=</span><span class="s">"utf-8"</span>&#x000A;  <span class="nt">meta</span><span class="w"> </span><span class="na">http-equiv</span><span class="p">=</span><span class="s">"X-UA-Compatible" content="IE=edge,chrome=1"</span>&#x000A;  <span class="c">/ Use title if it's in the page YAML frontmatter</span>&#x000A;  <span class="nt">title</span><span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">page</span><span class="p">.</span><span class="nf">title</span> <span class="o">||</span> <span class="s2">"HTML5 Boilerplate"</span>&#x000A;  <span class="nt">meta</span><span class="w"> </span><span class="na">name</span><span class="p">=</span><span class="s">"description" content=""</span>&#x000A;  <span class="nt">meta</span><span class="w"> </span><span class="na">name</span><span class="p">=</span><span class="s">"viewport" content="width=device-width"</span>&#x000A;&#x000A;  <span class="c">/ Place favicon.ico and apple-touch-icon.png in the root directory</span>&#x000A;&#x000A;  <span class="nt">link</span><span class="w"> </span><span class="na">rel</span><span class="p">=</span><span class="s">"stylesheet" href="css/normalize.css"</span>&#x000A;  <span class="nt">link</span><span class="w"> </span><span class="na">rel</span><span class="p">=</span><span class="s">"stylesheet" href="css/main.css"</span>&#x000A;  <span class="nt">script</span><span class="w"> </span><span class="na">src</span><span class="p">=</span><span class="s">"js/vendor/modernizr-2.6.1.min.js"</span>&#x000A;<span class="nt">body</span>&#x000A;  <span class="c">/[if lt IE 7]</span>&#x000A;    <span class="nt">p</span><span class="nc">.chromeframe</span>&#x000A;      <span class="p">|</span> You are using an outdated browser.&#x000A;      <span class="nt">a</span><span class="w"> </span><span class="na">href</span><span class="p">=</span><span class="s">"http://browsehappy.com/"</span><span class="w"> </span>|<span class="w"> </span>Upgrade<span class="w"> </span>your<span class="w"> </span>browser<span class="w"> </span>today<span class="w"> </span>or&#x000A;      <span class="nt">a</span><span class="w"> </span><span class="na">href</span><span class="p">=</span><span class="s">"http://www.google.com/chromeframe/?redirect=true"</span><span class="w"> </span>|<span class="w"> </span>install<span class="w"> </span>Google<span class="w"> </span>Chrome<span class="w"> </span>Frame<span class="w"> </span>to<span class="w"> </span>better<span class="w"> </span>experience<span class="w"> </span>this<span class="w"> </span>site<span class="nc">.</span>&#x000A;&#x000A;  <span class="p">==</span> <span class="k">yield</span>&#x000A;&#x000A;  <span class="nt">script</span><span class="w"> </span><span class="na">src</span><span class="p">=</span><span class="s">"//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"</span>&#x000A;  <span class="nd">javascript:&#x000A;</span>    <span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;script src="js/vendor/jquery-1.9.1.min.js"&gt;&lt;\/script&gt;'</span><span class="p">)</span>&#x000A;  <span class="nt">script</span><span class="w"> </span><span class="na">src</span><span class="p">=</span><span class="s">"js/plugins.js"</span>&#x000A;  <span class="nt">script</span><span class="w"> </span><span class="na">src</span><span class="p">=</span><span class="s">"js/main.js"</span>&#x000A;&#x000A;  <span class="c">/ Google Analytics: change UA-XXXXX-X to be your site's ID.</span>&#x000A;  <span class="nd">javascript:&#x000A;</span>    <span class="kd">var</span> <span class="nx">_gaq</span><span class="o">=</span><span class="p">[[</span><span class="s1">'_setAccount'</span><span class="p">,</span><span class="s1">'UA-XXXXX-X'</span><span class="p">],[</span><span class="s1">'_trackPageview'</span><span class="p">]];</span>&#x000A;    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">g</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span><span class="nx">s</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>&#x000A;    <span class="nx">g</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="p">(</span><span class="s1">'https:'</span><span class="o">==</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span><span class="p">?</span><span class="s1">'//ssl'</span><span class="p">:</span><span class="s1">'//www'</span><span class="p">)</span><span class="o">+</span><span class="s1">'.google-analytics.com/ga.js'</span><span class="p">;</span>&#x000A;    <span class="nx">s</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">s</span><span class="p">)}(</span><span class="nb">document</span><span class="p">,</span><span class="s1">'script'</span><span class="p">));</span>&#x000A;</code></pre> <p>On teste que tout fonctionne en relançant le serveur :</p> <pre class="highlight shell"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>middleman server&#x000A;</code></pre> <p>Et en rechargeant sa page de navigateur, on doit obtenir :</p> <p><img title="Hello World Middleman avec Slim" alt="Middleman Hello World avec Slim" src="../../images/middleman-02-hello-world-slim.png"/></p> <p>Hop, on committe :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git commit -a -m <span class="s1">'Ajout du language de templating Slim'</span>&#x000A;</code></pre> <h2 id=installation-de-sass>Installation de Sass</h2> <p>La gem <a href="//sass-lang.com">Sass</a> s&#39;est installée automatiquement avec Middleman, donc il suffit d&#39;ajouter un fichier <code>source/css/default.css.sass</code> avec une règle simple à l&#39;intérieur :</p> <pre class="highlight sass"><code><span class="nt">p</span>&#x000A;  <span class="nl">color</span><span class="p">:</span> <span class="no">red</span>&#x000A;</code></pre> <p>Puis de l&#39;inclure depuis le layout (<code>source/layouts/layout.slim</code>) en ajoutant une balise <code>&lt;link&gt;</code>. Ça doit donner ça :</p> <pre class="highlight slim"><code><span class="nt">link</span><span class="w"> </span><span class="na">rel</span><span class="p">=</span><span class="s">"stylesheet" href="css/normalize.css"</span>&#x000A;<span class="nt">link</span><span class="w"> </span><span class="na">rel</span><span class="p">=</span><span class="s">"stylesheet" href="css/main.css"</span>&#x000A;<span class="nt">link</span><span class="w"> </span><span class="na">rel</span><span class="p">=</span><span class="s">"stylesheet" href="css/default.css"</span>&#x000A;</code></pre> <p>En rechargeant la page du navigateur, on doit bien obtenir un texte en rouge :</p> <p><img title="Hello World Middleman avec Slim et Sass" alt="Middleman Hello World avec Slim et Sass" src="../../images/middleman-03-hello-world-slim-sass.png"/></p> <p>Committer (toujours committer !) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git add <span class="nb">source</span>/css/default.css.sass&#x000A;<span class="gp">$ </span>git commit -a -m <span class="s1">'Ajout du fichier Sass par défaut'</span>&#x000A;<span class="gp">$ </span>git push&#x000A;</code></pre> <h2 id=installation-de-coffeescript>Installation de CoffeeScript</h2> <p>Là encore, la gem CoffeeScript est déjà installée automatiquement avec Middleman, donc pas besoin de faire quoi que ce soit&hellip; juste à l&#39;utiliser.</p> <p>Ajouter les lignes suivantes au fichier <code>source/index.html.slim</code> :</p> <pre class="highlight slim"><code><span class="nt">p</span>&#x000A;  <span class="nt">a</span><span class="nf">#jquery-test</span><span class="w"> </span><span class="na">href</span><span class="p">=</span><span class="s">"#"</span>&#x000A;    <span class="p">|</span> Click Me&#x000A;</code></pre> <p>Créer un fichier <code>source/js/helpers.js.coffee</code> avec le contenu suivant :</p> <pre class="highlight coffeescript"><code><span class="nx">$</span><span class="p">(</span><span class="s">'#jquery-test'</span><span class="p">).</span><span class="na">on</span> <span class="s">'click'</span><span class="p">,</span> <span class="o">-&gt;</span>&#x000A;  <span class="nx">alert</span> <span class="s">'Yeah !'</span>&#x000A;</code></pre> <p>Inclure ce fichier depuis <code>source/js/main.js</code> en ajoutant la ligne suivante :</p> <pre class="highlight javascript"><code><span class="c1">//= require helpers</span>&#x000A;</code></pre> <p>En rechargeant la page et en cliquant sur le lien &ldquo;Click Me&rdquo;, vous devriez voir apparaitre une popup qui dit &ldquo;Yeah !&rdquo; :</p> <p><img title="Hello World Middleman avec Slim, Sass et CoffeeScript" alt="Middleman Hello World avec Slim, Sass et CoffeeScript" src="../../images/middleman-04-hello-world-slim-sass-coffee.png"/></p> <p>Committer, encore committer :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git add <span class="nb">source</span>/js/helpers.js.coffee&#x000A;<span class="gp">$ </span>git commit -a -m <span class="s2">"Ajout d'un ficher CoffeeScript"</span>&#x000A;<span class="gp">$ </span>git push&#x000A;</code></pre> <h2 id="ajout-d&#39;une-page-en-markdown">Ajout d&#39;une page en Markdown</h2> <p>J&#39;aime bien Markdown, c&#39;est simple à écrire, je m&#39;en sers pour les README sur GitHub, donc j&#39;en ai bien l&#39;habitude - surtout avec leur amélioration <a href="https://help.github.com/articles/github-flavored-markdown">GitHub Flavored Markup</a> - et ça se lit bien, même quand on est un misérable humain.</p> <p>Bref, j&#39;aimerais bien écrire mes articles en Markdown. On a qu&#39;à tester.</p> <p>Ma mégalomanie me dicte de commencer avec une page &ldquo;À propos de moi&rdquo;. Qui parle de moi donc.</p> <p>Créer un fichier <code>source/a-propos.html.md</code> avec à l&#39;intérieur :</p> <pre class="highlight markdown"><code><span class="gu">## À propos</span>&#x000A;&#x000A;<span class="p">![</span><span class="nv">Moi : Michael Baudino</span><span class="p">](</span><span class="sx">http://www.gravatar.com/avatar/db878dfa87aec08092efcb7cc12ab343?size=128</span> <span class="nn">"Moi : Michael Baudino"</span><span class="p">)</span>&#x000A;&#x000A;Moi, c'est Michael Baudino, je suis le co-fondateur de <span class="p">[</span><span class="nv">Alpine Lab</span><span class="p">](</span><span class="sx">https://alpine-lab.com</span><span class="p">)</span>, une société qui, pour l'instant, est principalement occupée à développer un portail de vente de forfaits de ski multi-stations : <span class="p">[</span><span class="nv">SkiWallet</span><span class="p">](</span><span class="sx">https://www.skiwallet.com</span><span class="p">)</span> !&#x000A;&#x000A;Vous pouvez me contacter sur <span class="p">[</span><span class="nv">GitHub</span><span class="p">](</span><span class="sx">https://github.com/michaelbaudino</span><span class="p">)</span>, par <span class="p">[</span><span class="nv">email</span><span class="p">](</span><span class="sx">mailto:michael.baudino@alpine-lab.com</span><span class="p">)</span> ou encore par <span class="p">[</span><span class="nv">le compte Twitter d'Alpine Lab</span><span class="p">](</span><span class="sx">https://twitter.com/AlpineLab</span><span class="p">)</span> <span class="p">(</span><span class="sx">c'est</span> moi derrière).&#x000A;</code></pre> <p>Vous pouvez mettre votre propre contenu, ne vous sentez pas obligé(e) de ré-écrire ma bio ;-)</p> <p>Note: pour le nom du fichier, on retrouve le schema classique (du moins si vous êtes un fidèle utilisateur de Sprockets, mais c&#39;est probablement le cas) : on veut générer un fichier HTML (extension <code>.html</code>), mais on veut l&#39;écrire en Markdown (extension <code>.md</code>), le fichier s&#39;appelle donc <code>a-propos.html.md</code>.</p> <p>Testons, en pointant un navigateur sur <a href="//localhost:4567/a-propos.html">http://localhost:4567/a-propos.html</a>. Vous devriez voir ça :</p> <p><img title="Page 'À propos' écrite en Markdown" alt="Page &quot;À propos&quot; écrite en Markdown" src="../../images/middleman-05-about.png"/></p> <p>Committer, committer, committer :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git add <span class="nb">source</span>/a-propos.html.md&#x000A;<span class="gp">$ </span>git commit -a -m <span class="s1">'Ajout de la page "A propos"'</span>&#x000A;<span class="gp">$ </span>git push&#x000A;</code></pre> <h2 id="liens-entre-les-pages-(et-autres-helpers)">Liens entre les pages (et autres helpers)</h2> <p>OK, on a maintenant deux pages (<code>index</code> et <code>a-propos</code>), on va pouvoir les lier. On va la jouer classique : on va créer un lien depuis la page d&#39;accueil vers la page &ldquo;À propos&rdquo;.</p> <p>On va utiliser pour ça les <a href="//middlemanapp.com/helpers/">Template Helpers</a> : des fonctions mises à notre disposition dans les pages par Middleman.</p> <p>Dans le fichier <code>source/index.html.slim</code>, ajouter les lignes suivantes :</p> <pre class="highlight slim"><code><span class="nt">p</span>&#x000A;  <span class="p">==</span> <span class="n">link_to</span> <span class="s1">'À propos'</span><span class="p">,</span> <span class="s1">'/a-propos.html'</span>&#x000A;</code></pre> <p>Si vous utilisez Rails, vous ne serez pas dépaysé(e), c&#39;est la même chose. Vous retrouverez, aussi d&#39;autres helpers familiers comme :</p> <ul> <li><code>stylesheet_link_tag</code></li> <li><code>javascript_include_tag</code></li> <li><code>image_tag</code></li> <li><code>form_tag</code> (et toute la famille qui va avec)</li> <li>le couple <code>content_for</code>/<code>yield_content</code></li> </ul> <p>Il y en a même d&#39;autres spécifiques à Middleman et vous pouvez en déclarer des customs. Je vous laisse vous reporter à <a href="//middlemanapp.com/helpers/">la doc</a> pour aller plus loin.</p> <p>Recharger votre page d&#39;accueil pour tester, ça doit marcher (je ne vous remet pas un screenshot, vous avez compris !).</p> <p>Et n&#39;oubliez pas de&hellip; committer :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git commit -a -m <span class="s1">'Ajout du lien vers la page "A Propos"'</span>&#x000A;<span class="gp">$ </span>git push&#x000A;</code></pre> <h2 id=mise-en-ligne-sur-github-pages>Mise en ligne sur GitHub Pages</h2> <p>OK, on a maintenant un site riche en contenu avec 2 pages. Mettons-le en ligne !</p> <p>Compilons tout ça :</p> <pre class="highlight shell"><code><span class="gp">$ </span>middleman build&#x000A;</code></pre> <p>Ça nous remplit donc le dossier <code>build/</code> de fichiers compilés, il faut maintenant les pusher sur un repository qui suit les recommandations <a href="https://help.github.com/articles/user-organization-and-project-pages">GitHub:Pages</a>.</p> <p>Par exemple, ma page est la page de mon organisation <code>alpinelab</code>, mon repository doit donc s&#39;appeler <code>alpinelab.github.com</code>.</p> <p>On va donc ajouter un remote pour ce nouveau repository, on l&#39;appelera intelligemment <code>gh-pages</code> (notez qu&#39;il pointe vers un repository différent de celui qui héberge les sources, c&#39;est important !) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git remote add gh-pages git@github.com:alpinelab/alpinelab.github.com.git&#x000A;</code></pre> <p>Ensuite on installe la gem qui va bien (<code>middleman-deploy</code>), en ajoutant au <code>Gemfile</code> la ligne suivante :</p> <pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'middleman-deploy'</span>&#x000A;</code></pre> <p>Suivi d&#39;un superbe :</p> <pre class="highlight shell"><code><span class="gp">$ </span>bundle install&#x000A;</code></pre> <p>On configure ladite gem en ajoutant au fichier <code>config.rb</code> :</p> <pre class="highlight ruby"><code><span class="n">activate</span> <span class="ss">:deploy</span> <span class="k">do</span> <span class="o">|</span><span class="n">deploy</span><span class="o">|</span>&#x000A;  <span class="n">deploy</span><span class="p">.</span><span class="nf">method</span> <span class="o">=</span> <span class="ss">:git</span>&#x000A;  <span class="n">deploy</span><span class="p">.</span><span class="nf">remote</span> <span class="o">=</span> <span class="s1">'gh-pages'</span>&#x000A;  <span class="n">deploy</span><span class="p">.</span><span class="nf">branch</span> <span class="o">=</span> <span class="s1">'master'</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre> <p>Et enfin, on déploie :</p> <pre class="highlight shell"><code><span class="gp">$ </span>middleman deploy&#x000A;</code></pre> <p>Et là, c&#39;est le drame : il faut attendre (jusqu&#39;à 10 minutes) pour que le site soit effectivement publié sur <a href="//alpinelab.github.com">http://alpinelab.github.com</a>.</p> <p>Mais normalement ça finit par arriver et ça marche :-)</p> <p>On committe :</p> <pre class="highlight shell"><code><span class="gp">$ </span>git commit -a -m <span class="s1">'Ajout de middleman-deploy'</span>&#x000A;</code></pre> <p>Pour ne pas avoir à attendre 10 minutes la prochaine fois, on va dire à GitHub de ne pas essayer de compiler avec Jekyll les fichiers que l&#39;on publie (puisque les fichiers qu&#39;on lui balance sont déjà compilés, avec Middleman) :</p> <pre class="highlight shell"><code><span class="gp">$ </span><span class="nb">cd </span>build&#x000A;<span class="gp">$ </span>touch .nojekyll&#x000A;<span class="gp">$ </span>git add .nojekyll&#x000A;<span class="gp">$ </span>git commit .nojekyll -m <span class="s1">'Ajout du nojekyll'</span>&#x000A;<span class="gp">$ </span>git push&#x000A;</code></pre> <p>Vous verrez que les prochains déploiements se feront beaucoup plus vite.</p> <h2 id=quelques-douceurs-en-bonus>Quelques douceurs en bonus</h2> <p>Dans le fichier de config (intelligemment nommé <code>config.rb</code>), il y a de quoi se faire plaisir.</p> <h3 id=livereload>LiveReload</h3> <p>Je suis un peu fainéant, j&#39;aime pas appuyer sur F5, alors j&#39;utilise LiveReload en ajoutant ça à mon Gemfile :</p> <pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'middleman-livereload'</span>&#x000A;<span class="n">gem</span> <span class="s1">'rb-inotify'</span>&#x000A;</code></pre> <p>Et ça à mon <code>config.rb</code> :</p> <pre class="highlight ruby"><code><span class="n">activate</span> <span class="ss">:livereload</span>&#x000A;</code></pre> <p>Puis après un petit :</p> <pre class="highlight shell"><code><span class="gp">$ </span>bundle install&#x000A;</code></pre> <p>Et voilà, dès qu&#39;on modifiera un fichier, le navigateur se rechargera tout seul. Elle est pas belle, la vie ?</p> <h3 id=minify>Minify</h3> <p>Il y a des pré-processeurs de minification en tous genre dans Middleman (vous savez, ça produit du code tout condensé, optimisé pour être plus léger).</p> <p>Perso, j&#39;utilise les directives suivantes dans mon <code>config.rb</code> :</p> <pre class="highlight ruby"><code><span class="n">activate</span> <span class="ss">:minify_html</span>&#x000A;<span class="n">activate</span> <span class="ss">:minify_css</span>&#x000A;<span class="n">activate</span> <span class="ss">:minify_javascript</span>&#x000A;</code></pre> <p>Pour que tout marche, j&#39;ai aussi besoin de ça dans mon <code>Gemfile</code> :</p> <pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'middleman-minify-html'</span>&#x000A;</code></pre> <h3 id=caching>Caching</h3> <p>Pour &ldquo;fingerprinter&rdquo; les assets (en langage un peu plus humain : pour mettre un hash à la fin des noms de fichiers des javascripts, css et autres images) afin d&#39;éviter qu&#39;un navigateur n&#39;utilise une version obsolète d&#39;un fichier qu&#39;il aurait gardé en cache, il suffit d&#39;ajouter cette ligne à <code>config.rb</code> (dans le block <code>configure :build</code>) :</p> <pre class="highlight ruby"><code><span class="n">activate</span> <span class="ss">:asset_hash</span>&#x000A;</code></pre> <h3 id=autres>Autres</h3> <p>J&#39;utilise aussi cette directive, pour générer les tailles des images tout seul à partir du helper <code>image_tag</code> :</p> <pre class="highlight ruby"><code><span class="n">activate</span> <span class="ss">:automatic_image_sizes</span>&#x000A;</code></pre> <h2 id=conclusion>Conclusion</h2> <p>Voilà, on a donc une stack Middleman capable de compiler du Sass, du CoffeeScript, du Slim, du Haml (on ne l&#39;a pas vu dans ce tutorial mais ça marche par défaut) et du Markdown.</p> <p>Et l&#39;ajout d&#39;une page est extrêmement facile :</p> <ol> <li>créer un fichier avec du contenu dedans (en Slim, Haml ou Markdown, au choix)</li> <li>publier d&#39;un simple <code>middleman build &amp;&amp; middleman deploy</code></li> </ol> <p>Classe ! Enfin&hellip; si vous y mettez vos propres règles CSS ! Parce que là, le texte en rouge, c&#39;est moyen la classe, en vérité.</p> <p>Dans le prochain article, on verra comment transformer tout ça en un vrai blog (avec un nom de domaine custom, des tags, une recherche, des pretty URLs, un sitemap, et même une syntax highlighting pour pouvoir poster des bouts de code).</p> <h2 id=resume>Résumé</h2> <p>Pour ceux d&#39;entre-vous qui veulent une version brève, la voici :</p> <pre class="highlight shell"><code><span class="gp">$ </span>gem install middleman&#x000A;<span class="gp">$ </span>middleman init mon projet --template<span class="o">=</span>html5&#x000A;</code></pre> <pre class="highlight ruby"><code><span class="c1"># Gemfile</span>&#x000A;&#x000A;<span class="n">gem</span> <span class="s1">'middleman'</span>&#x000A;<span class="n">gem</span> <span class="s1">'slim'</span>&#x000A;<span class="n">gem</span> <span class="s1">'middleman-deploy'</span>&#x000A;<span class="n">gem</span> <span class="s1">'middleman-livereload'</span>&#x000A;<span class="n">gem</span> <span class="s1">'rb-inotify'</span>&#x000A;<span class="n">gem</span> <span class="s1">'middleman-minify-html'</span>&#x000A;</code></pre> <pre class="highlight ruby"><code><span class="c1"># config.rb</span>&#x000A;<span class="n">set</span> <span class="ss">:css_dir</span><span class="p">,</span> <span class="s1">'css'</span>&#x000A;<span class="n">set</span> <span class="ss">:js_dir</span><span class="p">,</span> <span class="s1">'js'</span>&#x000A;<span class="n">set</span> <span class="ss">:images_dir</span><span class="p">,</span> <span class="s1">'img'</span>&#x000A;<span class="n">configure</span> <span class="ss">:build</span> <span class="k">do</span>&#x000A;  <span class="n">activate</span> <span class="ss">:minify_css</span>&#x000A;  <span class="n">activate</span> <span class="ss">:minify_javascript</span>&#x000A;  <span class="n">activate</span> <span class="ss">:minify_html</span>&#x000A;  <span class="n">activate</span> <span class="ss">:asset_hash</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="n">activate</span> <span class="ss">:deploy</span> <span class="k">do</span> <span class="o">|</span><span class="n">deploy</span><span class="o">|</span>&#x000A;  <span class="n">deploy</span><span class="p">.</span><span class="nf">method</span> <span class="o">=</span> <span class="ss">:git</span>&#x000A;  <span class="n">deploy</span><span class="p">.</span><span class="nf">remote</span> <span class="o">=</span> <span class="s1">'gh-pages'</span>&#x000A;  <span class="n">deploy</span><span class="p">.</span><span class="nf">branch</span> <span class="o">=</span> <span class="s1">'master'</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="n">activate</span> <span class="ss">:livereload</span>&#x000A;</code></pre> <p>Quelques commandes utiles :</p> <pre class="highlight shell"><code><span class="gp">$ </span>middleman server <span class="c"># lance le serveur de développement (avec LiveReload)</span>&#x000A;<span class="gp">$ </span>middleman build  <span class="c"># lance la compilation du site statique</span>&#x000A;<span class="gp">$ </span>middleman deploy <span class="c"># déploie le site statique</span>&#x000A;</code></pre> <p>Voilà, vous pouvez maintenant utiliser le surlanguage que vous voulez en suffixant le nom du fichier par l&#39;extension du language utilisé (<code>index.html.haml</code>, par exemple), Sprockets s&#39;occupe de tout.</p> <p>Enjoy :-)</p> <h3 id=sources>Sources</h3> <ul> <li>la <a href="//middlemanapp.com/getting-started">doc de Middleman</a>, qui est tellement bien foutue !</li> </ul> </div> <div class=author> Publié par <a href="https://twitter.com/michaelbaudino">Michael Baudino</a> <img alt='michael.baudino@alpine-lab.com' class=avatar src='//www.gravatar.com/avatar/db878dfa87aec08092efcb7cc12ab343?size=128'> </div> </article> <aside> <h3>Autres articles récents</h3> <ul> <li><a href="/blog/utiliser-les-presences-de-phoenix/">Utiliser les Presences de Phoenix</a></li> <li><a href="/blog/des-helpers-pour-verifier-la-version-de-rails/">Des helpers pour vérifier la version de Rails</a></li> <li><a href="/blog/skiwallet-a-la-conference-blend/">SkiWallet à la conférence Blend</a></li> <li><a href="/blog/installer-git-flow-dans-une-box-nitrous-io/">Installer git-flow dans une box Nitrous.IO</a></li> <li><a href="/blog/git-en-couleurs/">Git en couleurs</a></li> <li><a href="/blog/traduire-son-site-middleman-avec-locale/">Traduire son site Middleman avec Locale</a></li> <li><a href="/blog/generer-ses-vues-devise-en-haml/">Générer ses vues Devise en Haml</a></li> <li><a href="/blog/interdire-uniquement-l-enregistrement-de-nouveaux-utilisateurs-sous-devise/">Interdire uniquement l'enregistrement de nouveaux utilisateurs sous Devise</a></li> <li><a href="/blog/installer-font-awesome-sous-middleman/">Installer Font Awesome sous Middleman</a></li> <li><a href="/blog/un-alias-git-c-est-toujours-pratique/">Un alias git, c'est toujours pratique</a></li> </ul> </aside> </div> </div> <div id=corporate-btn> <a href="/">Alpine Lab <span class=caret></span> </a> </div> <footer> <p> Le blog d'<a rel=publisher href="https://plus.google.com/+AlpineLab">Alpine Lab</a> est publié sous license <a href="//creativecommons.org/licenses/by/3.0/fr/">Creative Commons Attribution 3.0 (cc-by-3.0)</a>. Le code est sous licence <a href="//opensource.org/licenses/MIT">MIT</a>. </p> </footer> </body> </html>