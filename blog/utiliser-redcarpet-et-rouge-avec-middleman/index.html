<!DOCTYPE html> <html> <head> <title>Utiliser RedCarpet et Rouge avec Middleman pour poster du code</title> <meta charset=UTF-8> <meta content="Pour pouvoir poster du code beau et lisible sur un blog Middleman, on va utiliser RedCarpet pour transformer notre Markdown en HTML puis Rouge pour découper ce HTML en tokens en fonction du langage utilisé. On saupoudrera le tout d'un peu de CSS pour obtenir une vrai belle coloration syntaxique." name=description> <meta content='width=device-width, initial-scale=1.0, user-scalable=no' name=viewport> <meta content='Utiliser RedCarpet et Rouge avec Middleman pour poster du code' property='og:title'> <meta content="Pour pouvoir poster du code beau et lisible sur un blog Middleman, on va utiliser RedCarpet pour transformer notre Markdown en HTML puis Rouge pour découper ce HTML en tokens en fonction du langage utilisé. On saupoudrera le tout d'un peu de CSS pour obtenir une vrai belle coloration syntaxique." property='og:description'> <meta content=fr_FR property='og:locale'> <meta content='Alpine Lab' property='og:site_name'> <meta content='http://www.alpine-lab.com/blog/utiliser-redcarpet-et-rouge-avec-middleman/' property='og:url'> <meta content='http://www.alpine-lab.com../../images/logo-alpinelab-500.png' property='og:image'> <meta content=article property='og:type'> <link href='images/favicon.png' rel=icon> <link href='//fonts.googleapis.com/css?family=Lato:300,400,700%7CMontserrat:400,700' rel=stylesheet> <link href="../../stylesheets/blog-fb2780ef.css" rel=stylesheet /> <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.min.css" rel=stylesheet /> </head> <body class='blog blog_utiliser-redcarpet-et-rouge-avec-middleman blog_utiliser-redcarpet-et-rouge-avec-middleman_index'> <meta content='Alpine Lab, blog technique' itemprop=name> <meta content="On parle de développement web, d'entreprenariat, de Ruby/Rails, de Haml/Slim, de Sass, de CoffeeScript et d'Ember.js" itemprop=description> <meta content='http://www.alpine-lab.com/blog' itemprop=url> <meta content=fr itemprop=inLanguage> <meta content='http://www.alpine-lab.com../../images/logo-alpinelab-500.png' itemprop=image> <div id=wrapper> <header> <a href="/blog"><div class=logo></div> <h1 class=sitename><span class=alpine>Alpine</span><span class=lab>Lab</span> <span class=blog>blog technique</span> </h1> </a> <div class=social-networks> <a target=_blank href="https://github.com/alpinelab"><i class='fa fa-github'></i> </a> <a target=_blank href="https://twitter.com/alpinelab"><i class='fa fa-twitter'></i> </a> </div> </header> <div id=main> <article itemscope itemtype='http://schema.org/BlogPosting'> <meta content="Pour pouvoir poster du code beau et lisible sur un blog Middleman, on va utiliser RedCarpet pour transformer notre Markdown en HTML puis Rouge pour découper ce HTML en tokens en fonction du langage utilisé. On saupoudrera le tout d'un peu de CSS pour obtenir une vrai belle coloration syntaxique." itemprop=description> <meta content='http://www.alpine-lab.com/blog/utiliser-redcarpet-et-rouge-avec-middleman/' itemprop=url> <meta content=fr itemprop=inLanguage> <h1 itemprop='name headline'>Utiliser RedCarpet et Rouge avec Middleman pour poster du code</h1> <time class=published datetime=2013-03-11 itemprop=datePublished> Publié le 11/03/2013 </time> <ul class=tags> <li> <i class='fa fa-tags'></i> </li> <li><a href="/blog/tags/middleman/">Middleman</a></li> <li><a href="/blog/tags/redcarpet/">Redcarpet</a></li> <li><a href="/blog/tags/rouge/">Rouge</a></li> <li><a href="/blog/tags/markdown/">Markdown</a></li> </ul> <div class=post-body itemprop=articleBody> <p>Pour pouvoir poster du code beau et lisible sur un blog Middleman, on va utiliser <a href="https://github.com/vmg/redcarpet">RedCarpet</a> pour transformer notre Markdown en HTML puis <a href="https://github.com/jayferd/rouge">Rouge</a> pour découper ce HTML en tokens en fonction du langage utilisé. On saupoudrera le tout d&#39;un peu de CSS pour obtenir une vrai belle coloration syntaxique.</p> <h3 id=redcarpet>RedCarpet</h3> <p>C&#39;est assez simple, en fait : il faut générer son HTML à partir de fichiers Markdown en utilisant <a href="https://github.com/vmg/redcarpet">RedCarpet</a>.</p> <p>On l&#39;ajoute donc simplement au fichier <code>Gemfile</code> :</p> <pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'redcarpet'</span>&#x000A;</code></pre> <p>Puis on va dire à Middleman de l&#39;utiliser (avec quelques options pour reconnaitre automatiquement les blocs de code ou les liens HTTP, par exemple) :</p> <pre class="highlight ruby"><code><span class="n">set</span> <span class="ss">:markdown_engine</span><span class="p">,</span> <span class="ss">:redcarpet</span>&#x000A;<span class="n">set</span> <span class="ss">:markdown</span><span class="p">,</span> <span class="ss">fenced_code_blocks: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">autolink: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">smartypants: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">gh_blockcode: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">lax_spacing: </span><span class="kp">true</span>&#x000A;</code></pre> <p>C&#39;est tout, RedCarpet va maintenant transformer tous les blocs de codes (entourés de simples ou triple backquotes) en balises <code>&lt;code&gt;</code> (elles-mêmes imbriquées dans des balises <code>&lt;pre&gt;</code> si la version triple-backquotes est utilisée).</p> <p>Le code Markdown que j&#39;utilise ressemble à ça (qui parlera aux habitués du Markdown de GitHub) :</p> <pre class=highlight>&#x000A;On l'ajoute donc simplement au fichier `Gemfile` :&#x000A;```ruby&#x000A;gem 'redcarpet'&#x000A;```</pre> <p>Et il est compilé par RedCarpet en ce code HTML :</p> <pre class="highlight html"><code><span class="nt">&lt;p&gt;</span>On l'ajoute donc simplement au fichier <span class="nt">&lt;code&gt;</span>Gemfile<span class="nt">&lt;/code&gt;</span> :<span class="nt">&lt;/p&gt;</span>&#x000A;<span class="nt">&lt;pre&gt;</span>&#x000A;  <span class="nt">&lt;code</span> <span class="na">class=</span><span class="s">"ruby"</span><span class="nt">&gt;</span>&#x000A;    gem 'redcarpet'&#x000A;  <span class="nt">&lt;/code&gt;</span>&#x000A;<span class="nt">&lt;/pre&gt;</span>&#x000A;</code></pre> <p>Avec un peu de CSS (c&#39;est du Sass, en fait), histoire que ça ait un peu de gueule : fond gris, bordure grise, angles arrondis et du padding plus ou moins grand selon qu&#39;on est dans un bloc inline (simple backquote) ou pleine-ligne (triple backquote).</p> <pre class="highlight sass"><code><span class="nt">code</span>&#x000A;  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="m">0</span><span class="mi">.1em</span>&#x000A;  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="mi">.1em</span> <span class="m">0</span><span class="mi">.2em</span>&#x000A;  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="mh">#d5d6d7</span>&#x000A;  <span class="nl">background-color</span><span class="p">:</span> <span class="mh">#fcfcfc</span>&#x000A;  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">0</span><span class="mi">.2em</span>&#x000A;&#x000A;<span class="nt">pre</span>&#x000A;  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="m">0</span><span class="mi">.2em</span>&#x000A;  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="mi">.5em</span> <span class="m">1em</span>&#x000A;  <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="mh">#d5d6d7</span>&#x000A;  <span class="nl">background-color</span><span class="p">:</span> <span class="mh">#fcfcfc</span>&#x000A;  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">0</span><span class="mi">.4em</span>&#x000A;&#x000A;  <span class="nt">code</span>&#x000A;    <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span>&#x000A;    <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span>&#x000A;    <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span>&#x000A;    <span class="nl">background</span><span class="p">:</span> <span class="nb">none</span>&#x000A;</code></pre> <p>On doit donc obtenir un truc comme ça :</p> <p><img title="RedCarpet avec Middleman" alt="RedCarpet avec Middleman" width=1017 height=376 src="../../images/blog/middleman-redcarpet-33014c95.png"/></p> <h3 id=coloration-syntaxique-avec-rouge>Coloration syntaxique avec Rouge</h3> <p><a href="https://github.com/jayferd/rouge">Rouge</a> est un <a href="//fr.wikipedia.org/wiki/Analyse_lexicale">analyseur lexical</a> qui permet de découper le code (précédemment détecté par RedCarpet) en tout un tas de balises <code>&lt;span&gt;</code> qui peuvent ensuite être stylées (donc colorées). Rouge est compatible avec Pygments (un analyseur lexical en Python très populaire, notamment utilisé par GitHub, entre autres), ce qui signifie que les styles CSS disponibles pour Pygments (comme tous ceux de <a href="//igniteflow.com/pygments/themes">IgniteFlow</a>, par exemple) vont fonctionner.</p> <p>Passons aux choses sérieuse : comment on fait ? En premier lieu, il faut installer la gem qui va bien (développée par <a href="https://github.com/Linuus">Linus Pettersson</a>, merci à lui) :</p> <pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'middleman-rouge'</span>&#x000A;</code></pre> <p>Ensuite on pense à l&#39;installer :</p> <pre class="highlight shell"><code><span class="gp">$ </span>bundle install&#x000A;</code></pre> <p>Il suffit ensuite de dire à Middleman de l&#39;utiliser, en ajoutant au fichier <code>config.rb</code> :</p> <pre class="highlight ruby"><code><span class="n">activate</span> <span class="ss">:rouge_syntax</span>&#x000A;</code></pre> <p>À ce point là, votre code est découpé en plein de petits <code>&lt;span&gt;</code>, ce qui donne, pour le même bout de Markdown que celui utilisé plus haut :</p> <pre class="highlight html"><code><span class="nt">&lt;p&gt;</span>On l'ajoute donc simplement au fichier <span class="nt">&lt;code&gt;</span>Gemfile<span class="nt">&lt;/code&gt;</span> :<span class="nt">&lt;/p&gt;</span>&#x000A;<span class="nt">&lt;pre</span> <span class="na">class=</span><span class="s">"highlight ruby"</span><span class="nt">&gt;</span>&#x000A;  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"n"</span><span class="nt">&gt;</span>gem<span class="nt">&lt;/span&gt;</span>&#x000A;  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"s1"</span><span class="nt">&gt;</span>'redcarpet'<span class="nt">&lt;/span&gt;</span>&#x000A;<span class="nt">&lt;/pre&gt;</span>&#x000A;</code></pre> <p>Vous remarquez que Rouge supprime la balise <code>&lt;code&gt;</code> que RedCarpet avait générée. Je n&#39;ai aucune idée de pourquoi il fait ça, mais c&#39;est utile de le savoir quand on veut appliquer des CSS dessus.</p> <p>En parlant de CSS, maintenant que notre structure HTML est créée, il reste à lui appliquer des couleurs à l&#39;aide d&#39;une feuille de styles. Comme je suis un peu fainéant, j&#39;ai choisi un thème tout fait, <a href="//studiostyl.es/schemes/monokai">Monokai</a>, parce que c&#39;est celui que j&#39;utilise dans mon éditeur de code, <a href="//www.sublimetext.com/2">Sublime Text 2</a>.</p> <p>Bref, j&#39;ai donc récupéré le code CSS du thème de Monokai du projet <a href="https://github.com/richleland/pygments-css">pygments-css</a>, que j&#39;ai mis dans un fichier <code>source/css/syntax-monokai.css</code>. Pour que ça fonctionne, il faut quand même le modifier un poil : il faut remplacer tous les <code>.codehilite</code> par des <code>.highlite</code> et supprimer le <code>.hll</code> de la première ligne. Ce qui donne ça (je ne vous met que les premières lignes, après c&#39;est pareil) :</p> <pre class="highlight css"><code><span class="c">/* Monokai theme from https://github.com/richleland/pygments-css */</span>&#x000A;<span class="nc">.highlight</span>      <span class="p">{</span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#49483e</span><span class="p">;</span> <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span> <span class="p">}</span>&#x000A;<span class="nc">.highlight</span> <span class="nc">.c</span>   <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#75715e</span> <span class="p">}</span> <span class="c">/* Comment */</span>&#x000A;<span class="nc">.highlight</span> <span class="nc">.err</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#960050</span><span class="p">;</span> <span class="nl">background-color</span><span class="p">:</span> <span class="m">#1e0010</span> <span class="p">}</span> <span class="c">/* Error */</span>&#x000A;<span class="nc">.highlight</span> <span class="nc">.k</span>   <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#66d9ef</span> <span class="p">}</span> <span class="c">/* Keyword */</span>&#x000A;<span class="nc">.highlight</span> <span class="nc">.l</span>   <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#ae81ff</span> <span class="p">}</span> <span class="c">/* Literal */</span>&#x000A;<span class="nc">.highlight</span> <span class="nc">.n</span>   <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#f8f8f2</span> <span class="p">}</span> <span class="c">/* Name */</span>&#x000A;<span class="nc">.highlight</span> <span class="nc">.o</span>   <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#f92672</span> <span class="p">}</span> <span class="c">/* Operator */</span>&#x000A;<span class="nc">.highlight</span> <span class="nc">.p</span>   <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#f8f8f2</span> <span class="p">}</span> <span class="c">/* Punctuation */</span>&#x000A;<span class="o">...</span>&#x000A;</code></pre> <p>Comme vous l&#39;avez peut-être remarqué, j&#39;ai ajouté un <code>color: white;</code> à la première règle. Pure question de goût. Il faut juste savoir que pour le texte non-coloré par Rouge, c&#39;est la couleur du texte de la page web qui est utilisé. Pour moi, c&#39;était gris. Sur le fond gris, ça n&#39;allait pas terrible. C&#39;est pourquoi je le force en blanc.</p> <p>Pensez quand même à importer ce nouveau fichier, en ajoutant la ligne suivante à votre fichier <code>source/css/default.css.sass</code> :</p> <pre class="highlight sass"><code><span class="k">@import</span> <span class="s">'syntax-monokai'</span>&#x000A;</code></pre> <p>Voilà, en relançant éventuellement votre serveur Middleman et en rechargeant votre page de navigateur, vous devez obtenir à peu près ça :</p> <p><img title="RedCarpet et Rouge avec Middleman" alt="RedCarpet et Rouge avec Middleman" width=1039 height=577 src="../../images/blog/middleman-redcarpet-rouge-1d207186.png"/></p> <h4 id=sources>Sources</h4> <ul> <li><a href="https://github.com/middleman/middleman/issues/577">Cette issue</a> de Middleman</li> <li>le <a href="https://github.com/middleman/middleman-syntax">README de middleman-syntax</a></li> <li>le <a href="https://github.com/Linuus/middleman-rouge">README de middleman-rouge</a></li> <li>les <a href="//igniteflow.com/pygments/themes">thèmes IgniteFlow</a> et <a href="https://github.com/richleland/pygments-css">leur code CSS</a></li> </ul> </div> <div class=author> Publié par <a href="https://twitter.com/michaelbaudino">Michael Baudino</a> <img alt='michael.baudino@alpine-lab.com' class=avatar src='//www.gravatar.com/avatar/db878dfa87aec08092efcb7cc12ab343?size=128'> </div> </article> <aside> <h3>Autres articles récents</h3> <ul> <li><a href="/blog/utiliser-les-presences-de-phoenix/">Utiliser les Presences de Phoenix</a></li> <li><a href="/blog/des-helpers-pour-verifier-la-version-de-rails/">Des helpers pour vérifier la version de Rails</a></li> <li><a href="/blog/skiwallet-a-la-conference-blend/">SkiWallet à la conférence Blend</a></li> <li><a href="/blog/installer-git-flow-dans-une-box-nitrous-io/">Installer git-flow dans une box Nitrous.IO</a></li> <li><a href="/blog/git-en-couleurs/">Git en couleurs</a></li> <li><a href="/blog/traduire-son-site-middleman-avec-locale/">Traduire son site Middleman avec Locale</a></li> <li><a href="/blog/generer-ses-vues-devise-en-haml/">Générer ses vues Devise en Haml</a></li> <li><a href="/blog/interdire-uniquement-l-enregistrement-de-nouveaux-utilisateurs-sous-devise/">Interdire uniquement l'enregistrement de nouveaux utilisateurs sous Devise</a></li> <li><a href="/blog/installer-font-awesome-sous-middleman/">Installer Font Awesome sous Middleman</a></li> <li><a href="/blog/un-alias-git-c-est-toujours-pratique/">Un alias git, c'est toujours pratique</a></li> </ul> </aside> </div> </div> <div id=corporate-btn> <a href="/">Alpine Lab <span class=caret></span> </a> </div> <footer> <p> Le blog d'<a rel=publisher href="https://plus.google.com/+AlpineLab">Alpine Lab</a> est publié sous license <a href="//creativecommons.org/licenses/by/3.0/fr/">Creative Commons Attribution 3.0 (cc-by-3.0)</a>. Le code est sous licence <a href="//opensource.org/licenses/MIT">MIT</a>. </p> </footer> </body> </html>