<!DOCTYPE html> <html> <head> <title>Activer le SSL sur Heroku</title> <meta charset=UTF-8> <meta content="Le but de cet article est de montrer comment héberger un site HTTPS sur Heroku.&#x000A;&#x000A;Il suffit de 3 étapes : générer son certificat, installer l'addon Heroku qui va bien, configurer ses DNS." name=description> <meta content='width=device-width, initial-scale=1.0, user-scalable=no' name=viewport> <meta content='Activer le SSL sur Heroku' property='og:title'> <meta content="Le but de cet article est de montrer comment héberger un site HTTPS sur Heroku.&#x000A;&#x000A;Il suffit de 3 étapes : générer son certificat, installer l'addon Heroku qui va bien, configurer ses DNS." property='og:description'> <meta content=fr_FR property='og:locale'> <meta content='Alpine Lab' property='og:site_name'> <meta content='http://www.alpine-lab.com/blog/activer-le-ssl-sur-heroku/' property='og:url'> <meta content='http://www.alpine-lab.com../../images/logo-alpinelab-500.png' property='og:image'> <meta content=article property='og:type'> <link href='images/favicon.png' rel=icon> <link href='//fonts.googleapis.com/css?family=Lato:300,400,700%7CMontserrat:400,700' rel=stylesheet> <link href="../../stylesheets/blog-fb2780ef.css" rel=stylesheet /> <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.min.css" rel=stylesheet /> </head> <body class='blog blog_activer-le-ssl-sur-heroku blog_activer-le-ssl-sur-heroku_index'> <meta content='Alpine Lab, blog technique' itemprop=name> <meta content="On parle de développement web, d'entreprenariat, de Ruby/Rails, de Haml/Slim, de Sass, de CoffeeScript et d'Ember.js" itemprop=description> <meta content='http://www.alpine-lab.com/blog' itemprop=url> <meta content=fr itemprop=inLanguage> <meta content='http://www.alpine-lab.com../../images/logo-alpinelab-500.png' itemprop=image> <div id=wrapper> <header> <a href="/blog"><div class=logo></div> <h1 class=sitename><span class=alpine>Alpine</span><span class=lab>Lab</span> <span class=blog>blog technique</span> </h1> </a> <div class=social-networks> <a target=_blank href="https://github.com/alpinelab"><i class='fa fa-github'></i> </a> <a target=_blank href="https://twitter.com/alpinelab"><i class='fa fa-twitter'></i> </a> </div> </header> <div id=main> <article itemscope itemtype='http://schema.org/BlogPosting'> <meta content="Le but de cet article est de montrer comment héberger un site HTTPS sur Heroku.&#x000A;&#x000A;Il suffit de 3 étapes : générer son certificat, installer l'addon Heroku qui va bien, configurer ses DNS." itemprop=description> <meta content='http://www.alpine-lab.com/blog/activer-le-ssl-sur-heroku/' itemprop=url> <meta content=fr itemprop=inLanguage> <h1 itemprop='name headline'>Activer le SSL sur Heroku</h1> <time class=published datetime=2013-03-09 itemprop=datePublished> Publié le 09/03/2013 </time> <ul class=tags> <li> <i class='fa fa-tags'></i> </li> <li><a href="/blog/tags/ssl/">Ssl</a></li> <li><a href="/blog/tags/heroku/">Heroku</a></li> </ul> <div class=post-body itemprop=articleBody> <p>Le but de cet article est de montrer comment héberger un site HTTPS sur <a href="//www.heroku.com">Heroku</a>.</p> <p>Il suffit de 3 étapes : générer son certificat, installer l&#39;addon Heroku qui va bien, configurer ses DNS.</p> <h3 id="générer-son-certificat">Générer son certificat</h3> <p>Pour le certificat, on a fait le choix d&#39;en acheter un avec validation étendue (EV, pour Extended Validation) chez Thawte.</p> <p>Il faut tout d&#39;abord <strong>créer une clé privée</strong> avec password (dans un répertoire qui n&#39;est pas public : cette clef est hautement confidentielle) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>openssl genrsa -des3 -out server.orig.key 2048&#x000A;</code></pre> <p>Cette commande demandera quelques renseignements relatives à l&#39;émetteur de la clef (vous !). Attention, pour l&#39;EV toutes les infos doivent être exactes.</p> <p>Il faut ensuite <strong>virer le password de cette clef</strong> (sinon Heroku ne pourra pas l&#39;utiliser puisque le password sera demandé à chaque démarrage du serveur) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>openssl rsa -in server.orig.key -out server.key&#x000A;</code></pre> <p>Ensuite on va <strong>créer le CSR</strong> correspondant (Certificate Signing Request, qui permet de demander à Thawte de nous générer un certificat) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>openssl req -new -key server.key -out server.csr&#x000A;</code></pre> <p>Il suffit ensuite d&rsquo;<strong>envoyer le CSR</strong> à Thawte (en précisant &ldquo;Autre&rdquo; comme plate-forme pour le serveur), puis d&rsquo;<strong>attendre son certificat</strong> qu&#39;on reçoit par mail (ça peut prendre plusieurs jours : pour l&#39;EV, Thawte va vérifier qu&#39;on est une société déposée et qu&#39;on a un numéro de téléphone dans les Pages Jaunes ou Kompass ou 118712) qu&#39;on colle alors dans un fichier <code>thawte_SkiWallet.pem</code> (dans le même répertoire que les clefs et certificats créés précédemment).</p> <h3 id="installer-le-plugin-heroku-ssl-endpoint-(et-le-configurer)">Installer le plugin Heroku SSL-Endpoint (et le configurer)</h3> <p>Pour ça rien, de plus simple, si vous êtes déja familier avec la <a href="https://toolbelt.heroku.com">Toolbelt Heroku</a>. Éxecutez simplement à la racine de votre projet hébergé :</p> <pre class="highlight shell"><code><span class="gp">$ </span>heroku addons:add ssl&#x000A;</code></pre> <p>Depuis le répertoire dans lequel vous avez mis toutes les clefs et autres certificats générés précédemment, vérifier que la chaîne de confiance des certificats d&#39;autorité intermédiaires est complète (la commande doit vous afficher une succession de certificats SSL si tout s&#39;est bien passé, sinon, un message d&#39;erreur) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>heroku certs:chain thawte_SkiWallet.pem&#x000A;</code></pre> <p>Vérifier ensuite que la clef privée correspond au certificat Thawte (la commande vous affichera la clef SSL en cas de succès, un message d&#39;erreur sinon) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>heroku certs:key thawte_SkiWallet.pem server.key&#x000A;</code></pre> <p>Ajouter finalement tout ce tintouin à votre appli Heroku (suffixez avec <code>--app nom-de-votre-app-heroku</code> si votre toolbelt est configurée pour gérer plusieurs applications Heroku) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>heroku certs:add <span class="k">*</span>&#x000A;</code></pre> <h3 id=configurer-son-serveur-dns>Configurer son serveur DNS</h3> <p>OK, on a donc installé notre certificat (ouf !), il faut maintenant configurer son serveur DNS. On va commencer par récupérer l&#39;adresse du endpoint SSL qui nous a été assigné par Heroku. Elle s&#39;affiche dans la colonne &ldquo;Endpoint&rdquo; de la commande suivant) :</p> <pre class="highlight shell"><code><span class="gp">$ </span>heroku certs&#x000A;</code></pre> <p>Chez moi, c&#39;est <code>toyama-1696.herokussl.com</code>, dans ce qui suit, je vous laisse donc remplacer intelligemment par ce que vous aura répondu la commande ci-dessus.</p> <p>On va juste faire une ou deux petites vérifications :</p> <ul> <li>tester que le endpoint route bien vers le HTTPS : en pointant son navigateur vers <a href="//toyama-1696.herokussl.com">http://toyama-1696.herokussl.com</a> ça doit afficher &ldquo;No such app&rdquo;</li> <li>tester que le endpoint sert bien le certificat en SSl : en pointant son navigateur vers <a href="https://toyama-1696.herokussl.com">https://toyama-1696.herokussl.com</a> ça doit dire que le certificat est prévu pour votre nom de domaine (chez moi, <a href="//www.skiwallet.com">www.skiwallet.com</a>).</li> </ul> <p>OK, on a donc l&#39;URL du endpoint et ça semble fonctionner. Récupérons maintenant son adresse IP :</p> <pre class="highlight shell"><code><span class="gp">$ </span>host toyama-1696.herokussl.com&#x000A;</code></pre> <p>L&#39;adresse IP de mon endpoint, c&#39;est &ldquo;54.243.198.116&rdquo;, je vous laisse remplacer par la votre dans les exemple ci-dessous.</p> <p>Avant de configurer son serveur DNS, testez déjà en surchargeant ladite adresse IP pour pointer vers votre domaine (moi : <a href="//www.skiwallet.com">www.skiwallet.com</a>) sur votre machine (ça évite de casser votre config DNS existante). Ajoutez donc la ligne suivante à votre fichier <code>/etc/hosts</code> (il faut avoir les droits root donc utilisez <code>su</code> ou <code>sudo</code>, selon votre distrib) :</p> <pre class="highlight plaintext"><code>54.243.198.116  www.skiwallet.com&#x000A;</code></pre> <p>Testez en visitant <a href="https://www.skiwallet.com">https://www.skiwallet.com</a> avec votre navigateur (éventuellement, videz le cache avant). Votre site doit s&#39;afficher et la fameuse &ldquo;barre verte&rdquo; doit s&#39;afficher :-)</p> <p>Pensez à enlever la ligne de votre fichier hosts, ça serait bête de se galérer pour ça.</p> <p>On va donc pouvoir faire la vraie config, sur le vrai serveur DNS : changez vos DNS pour faire pointer <a href="//www.skiwallet.com">www.skiwallet.com</a> vers <code>toyama-1696.herokussl.com</code> avec un CNAME et le tour est joué.</p> <h3 id="bonus-:-forcer-rails-à-utiliser-https">Bonus : Forcer Rails à utiliser HTTPS</h3> <p>Si votre site est fait en Rails (comme le mien), il est super simple de lui dire de rediriger toutes les requêtes vers HTTPS, afin de forcer les utilisateurs en HTTPS.</p> <p>Il suffit donc de décommenter (ou ajouter) la ligne suivante dans le fichier <code>config/environments/production.rb</code> de votre projet :</p> <pre class="highlight ruby"><code><span class="n">config</span><span class="p">.</span><span class="nf">force_ssl</span> <span class="o">=</span> <span class="kp">true</span>&#x000A;</code></pre> <h4 id=sources>Sources</h4> <ul> <li>Article <a href="https://devcenter.heroku.com/articles/csr">Creating an SSL Certificate Signing Request</a> sur le DevCenter Heroku</li> <li>Article <a href="https://devcenter.heroku.com/articles/ssl-endpoint">SSL Endpoint</a> sur le DevCenter Heroku</li> </ul> </div> <div class=author> Publié par <a href="https://twitter.com/michaelbaudino">Michael Baudino</a> <img alt='michael.baudino@alpine-lab.com' class=avatar src='//www.gravatar.com/avatar/db878dfa87aec08092efcb7cc12ab343?size=128'> </div> </article> <aside> <h3>Autres articles récents</h3> <ul> <li><a href="/blog/utiliser-les-presences-de-phoenix/">Utiliser les Presences de Phoenix</a></li> <li><a href="/blog/des-helpers-pour-verifier-la-version-de-rails/">Des helpers pour vérifier la version de Rails</a></li> <li><a href="/blog/skiwallet-a-la-conference-blend/">SkiWallet à la conférence Blend</a></li> <li><a href="/blog/installer-git-flow-dans-une-box-nitrous-io/">Installer git-flow dans une box Nitrous.IO</a></li> <li><a href="/blog/git-en-couleurs/">Git en couleurs</a></li> <li><a href="/blog/traduire-son-site-middleman-avec-locale/">Traduire son site Middleman avec Locale</a></li> <li><a href="/blog/generer-ses-vues-devise-en-haml/">Générer ses vues Devise en Haml</a></li> <li><a href="/blog/interdire-uniquement-l-enregistrement-de-nouveaux-utilisateurs-sous-devise/">Interdire uniquement l'enregistrement de nouveaux utilisateurs sous Devise</a></li> <li><a href="/blog/installer-font-awesome-sous-middleman/">Installer Font Awesome sous Middleman</a></li> <li><a href="/blog/un-alias-git-c-est-toujours-pratique/">Un alias git, c'est toujours pratique</a></li> </ul> </aside> </div> </div> <div id=corporate-btn> <a href="/">Alpine Lab <span class=caret></span> </a> </div> <footer> <p> Le blog d'<a rel=publisher href="https://plus.google.com/+AlpineLab">Alpine Lab</a> est publié sous license <a href="//creativecommons.org/licenses/by/3.0/fr/">Creative Commons Attribution 3.0 (cc-by-3.0)</a>. Le code est sous licence <a href="//opensource.org/licenses/MIT">MIT</a>. </p> </footer> </body> </html>